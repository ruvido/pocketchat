<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root { --max-width: 600px; }
        * { box-sizing: border-box; }
        body { 
            margin: 0; 
            font-family: system-ui;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        #messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            padding-bottom: 70px;
        }
        .message {
            margin-bottom: 1rem;
            max-width: 70%;
            padding: 0.8rem;
            border-radius: 1rem;
            background: #e0e0e0;
        }
        .own-message {
            margin-left: auto;
            background: #007bff;
            color: white;
        }
        #input-container {
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: var(--max-width);
            background: white;
            padding: 1rem;
            display: flex;
            gap: 0.5rem;
        }
        #message-input {
            flex: 1;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 1.5rem;
        }
        button {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 1.5rem;
            background: #007bff;
            color: white;
        }
    </style>
</head>
<body>
    <div id="messages"></div>
    <div id="input-container">
        <input type="text" id="message-input" placeholder="Type message...">
        <button onclick="sendMessage()">Send</button>
    </div>

    <script src="https://unpkg.com/pocketbase@0.25.0/dist/pocketbase.umd.js"></script>
    <script>
        const pb = new PocketBase('http://127.0.0.1:8090');
        let currentUser = prompt('Enter your name') || 'Anonymous';

        // Real-time subscription
        pb.collection('messages').subscribe('*', function (e) {
            addMessageToUI(e.record);
        });

        // Load existing messages
        pb.collection('messages').getList(1, 50, {
            sort: '-created',
        }).then(res => {
            res.items.reverse().forEach(addMessageToUI);
        });

        function sendMessage() {
            const input = document.getElementById('message-input');
            pb.collection('messages').create({
                user: currentUser,
                message: input.value
            });
            input.value = '';
        }

        function addMessageToUI(message) {
            const div = document.createElement('div');
            div.className = `message ${message.user === currentUser ? 'own-message' : ''}`;
            div.innerHTML = `
                <strong>${message.user}</strong>
                <p>${message.message}</p>
                <small>${new Date(message.created).toLocaleTimeString()}</small>
            `;
            document.getElementById('messages').appendChild(div);
            window.scrollTo(0, document.body.scrollHeight);
        }
    </script>
</body>
</html>
